<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Create Video Campaign</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="bg-gray-100 py-10">
    <div class="max-w-6xl mx-auto bg-white rounded-2xl shadow-xl p-10">
      <h2 class="text-3xl font-semibold text-center text-gray-800 mb-8">
        Create Sponsored Brands Video Campaign
      </h2>
      <form id="campaignForm">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="space-y-4">
            <div>
              <label for="country" class="block font-semibold text-gray-700"
                >Country</label
              >
              <select
                id="country"
                required
                class="w-full mt-1 p-3 border rounded-lg"
              >
                <option value="US">United States</option>
                <option value="CA">Canada</option>
              </select>
            </div>
            <div>
              <label
                for="productNumber"
                class="block font-semibold text-gray-700"
                >Product Number</label
              >
              <input
                type="text"
                id="productNumber"
                required
                class="w-full mt-1 p-3 border rounded-lg"
              />
            </div>
            <div>
              <label for="sku" class="block font-semibold text-gray-700"
                >SKU</label
              >
              <input
                type="text"
                id="sku"
                required
                class="w-full mt-1 p-3 border rounded-lg"
              />
            </div>
            <div>
              <label for="asin" class="block font-semibold text-gray-700"
                >ASIN</label
              >
              <input
                type="text"
                id="asin"
                required
                class="w-full mt-1 p-3 border rounded-lg"
              />
            </div>
            <div>
              <label for="portfolioId" class="block font-semibold text-gray-700"
                >Portfolio ID
                <span class="text-gray-500">(optional)</span></label
              >
              <div
                class="flex flex-col items-center sm:flex-row sm:items-end gap-2"
              >
                <input
                  type="text"
                  id="portfolioId"
                  class="w-full mt-1 p-3 border rounded-lg"
                />
                <button
                  type="button"
                  onclick="window.open('https://docs.google.com/spreadsheets/d/1uvQitfIkrXISu3oIXBeZ-3giGHw2hqWfNY6ih9STntI/edit?usp=sharing', '_blank')"
                  class="text-blue-600 underline text-sm"
                >
                  Check here
                </button>
              </div>
            </div>
            <div>
              <label for="videoId" class="block font-semibold text-gray-700"
                >Video Media ID</label
              >
              <div
                class="flex flex-col items-center sm:flex-row sm:items-end gap-2"
              >
                <input
                  type="text"
                  id="videoId"
                  required
                  class="w-full mt-1 p-3 border rounded-lg"
                />
                <button
                  type="button"
                  onclick="document.getElementById('videoModal').classList.remove('hidden')"
                  class="text-blue-600 underline text-sm"
                >
                  How to get
                </button>
              </div>
            </div>
            <div>
              <label
                for="campaignType"
                class="block font-semibold text-gray-700"
                >Campaign Type</label
              >
              <select
                id="campaignType"
                required
                class="w-full mt-1 p-3 border rounded-lg"
              >
                <option value="broad">Video Ads Broad</option>
                <option value="phrase">Video Ads Phrase</option>
                <option value="exact">Video Ads Exact</option>
              </select>
            </div>
          </div>
          <div class="space-y-4 flex flex-col">
            <div class="flex flex-col lg:flex-row gap-4 h-full">
              <div class="flex-1 flex flex-col">
                <label
                  for="keywords"
                  class="block font-semibold text-gray-700 mb-1"
                  >Targeting Keywords<br />(one per line)</label
                >
                <textarea
                  id="keywords"
                  required
                  class="w-full h-full p-3 border rounded-lg resize-none"
                ></textarea>
              </div>
              <div class="flex-1 flex flex-col">
                <label
                  for="negativeKeywords"
                  class="block font-semibold text-gray-700 mb-1"
                  >Negative Keywords<br />(one per line)</label
                >
                <textarea
                  id="negativeKeywords"
                  class="w-full h-full p-3 border rounded-lg resize-none"
                ></textarea>
              </div>
            </div>
            <div class="flex gap-3">
              <button
                type="button"
                id="clearFields"
                class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 rounded-lg min-w-[150px]"
              >
                Clear Fields
              </button>
              <button
                type="button"
                id="clearTemplate"
                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 rounded-lg min-w-[150px]"
              >
                Clear Template
              </button>
            </div>
            <div class="flex flex-wrap gap-3">
              <button
                type="button"
                id="addTemplate"
                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg min-w-[150px]"
              >
                Add to Template
              </button>
              <button
                type="button"
                id="downloadExcel"
                class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg min-w-[150px]"
              >
                Download Excel
              </button>
            </div>
          </div>
        </div>
      </form>
      <div
        id="campaignList"
        class="mt-6 bg-gray-200 p-4 rounded-lg max-h-56 overflow-y-auto text-sm text-gray-800"
      ></div>
    </div>

    <!-- Video ID Modal -->
    <div
      id="videoModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50"
    >
      <div class="bg-white rounded-lg shadow-lg max-w-md w-full p-6">
        <h3 class="text-lg font-semibold mb-4">How to get Video Media ID</h3>
        <p class="text-gray-700 mb-6">
          Go to your ad console, navigate to
          <strong>Assets &gt; Video</strong> and upload your video first. Youâ€™ll
          find the Video Media ID associated with each uploaded video.
        </p>
        <div class="text-right">
          <button
            onclick="document.getElementById('videoModal').classList.add('hidden')"
            class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <script>
      let campaignData = [];
      const campaignList = document.getElementById("campaignList");

      const defaultColumns = [
        "Product",
        "Entity",
        "Operation",
        "Campaign Id",
        "Draft Campaign Id",
        "Portfolio Id",
        "Campaign Name",
        "Start Date",
        "End Date",
        "State",
        "Budget Type",
        "Budget",
        "Bid Optimization",
        "Bid Multiplier",
        "Bid",
        "Keyword Text",
        "Match Type",
        "Product Targeting Expression",
        "Ad Format",
        "Landing Page URL",
        "Landing Page asins",
        "Brand Entity Id",
        "Brand Name",
        "Brand Logo Asset Id",
        "Brand Logo URL",
        "Creative Headline",
        "Creative asins",
        "Video Media Ids",
        "Creative Type",
      ];

      const ensureDefaultColumns = (obj) => {
        return Object.fromEntries(
          defaultColumns.map((key) => [key, obj[key] ?? ""])
        );
      };

      document
        .getElementById("addTemplate")
        .addEventListener("click", async () => {
          const country = document.getElementById("country").value;
          const productNumber = document.getElementById("productNumber").value;
          const sku = document.getElementById("sku").value;
          const asin = document.getElementById("asin").value;
          const portfolioId = document.getElementById("portfolioId").value;
          const videoId = document.getElementById("videoId").value;
          const campaignType = document.getElementById("campaignType").value;
          const keywords = document
            .getElementById("keywords")
            .value.trim()
            .split("\n")
            .filter(Boolean);
          const negativeKeywords = document
            .getElementById("negativeKeywords")
            .value.trim()
            .split("\n")
            .filter(Boolean);

          const today = new Date().toISOString().slice(0, 10).replace(/-/g, "");
          const campaignId = `${productNumber} ${sku} Video Ads ${
            campaignType.charAt(0).toUpperCase() + campaignType.slice(1)
          }`;
          const brandEntityId =
            country === "US" ? "ENTITYCQP7AL92VN6L" : "ENTITY2DMN2Z7IO7RFX";

          const campaignEntry = ensureDefaultColumns({
            Product: "Sponsored Brands",
            Entity: "Campaign",
            Operation: "Create",
            "Campaign Id": campaignId,
            "Portfolio Id": portfolioId,
            "Campaign Name": campaignId,
            "Start Date": today,
            State: "Enabled",
            "Budget Type": "Daily",
            Budget: 10,
            "Bid Optimization": "Auto",
            "Ad Format": "video",
            "Brand Entity Id": brandEntityId,
            "Brand Name": "BlueStars",
            "Creative asins": asin,
            "Video Media Ids": videoId,
            "Creative Type": "video",
          });
          campaignData.push(campaignEntry);

          keywords.forEach((kw) => {
            const entry = ensureDefaultColumns({
              Product: "Sponsored Brands",
              Entity: "Keyword",
              Operation: "Create",
              "Campaign Id": campaignId,
              State: "Enabled",
              Bid: 0.25,
              "Keyword Text": kw,
              "Match Type": campaignType,
            });
            campaignData.push(entry);
          });

          negativeKeywords.forEach((kw) => {
            const entry = ensureDefaultColumns({
              Product: "Sponsored Brands",
              Entity: "Negative Keyword",
              Operation: "Create",
              "Campaign Id": campaignId,
              State: "Enabled",
              "Keyword Text": kw,
              "Match Type": "negativePhrase",
            });
            campaignData.push(entry);
          });

          const line = document.createElement("div");
          line.textContent = `âœ” Added: ${campaignId}`;
          campaignList.appendChild(line);
        });

      document
        .getElementById("downloadExcel")
        .addEventListener("click", async () => {
          const XLSX = await import(
            "https://cdn.sheetjs.com/xlsx-0.20.2/package/xlsx.mjs"
          );
          const output =
            campaignData.length > 0
              ? campaignData
              : [Object.fromEntries(defaultColumns.map((key) => [key, ""]))];
          const worksheet = XLSX.utils.json_to_sheet(output, {
            header: defaultColumns,
          });
          const workbook = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(workbook, worksheet, "Campaign");
          XLSX.writeFile(workbook, "Video_Campaign_Upload_Template.xlsx");
        });

      document.getElementById("clearFields").addEventListener("click", () => {
        document.getElementById("campaignForm").reset();
      });

      document.getElementById("clearTemplate").addEventListener("click", () => {
        campaignData = [];
        campaignList.innerHTML = "";
      });
    </script>
  </body>
</html>
