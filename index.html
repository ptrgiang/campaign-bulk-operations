<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Create Video Campaign</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
    </style>
  </head>
  <body class="bg-gray-100 py-10">
    <div
      class="max-w-6xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden px-8 py-10 space-y-10"
    >
      <h1 class="text-3xl font-bold text-center text-gray-800">
        Create Sponsored Brands Video Campaign
      </h1>

      <form id="campaignForm" class="space-y-10">
        <!-- Basic Information -->
        <div class="space-y-6">
          <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">
            Basic Information
          </h2>
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label
                for="country"
                class="block text-sm font-medium text-gray-700"
                >Country</label
              >
              <select
                id="country"
                required
                class="w-full mt-1 p-3 border rounded-lg bg-gray-50"
              >
                <option value="US">United States</option>
                <option value="CA">Canada</option>
              </select>
            </div>
            <div>
              <label
                for="campaignType"
                class="block text-sm font-medium text-gray-700"
                >Campaign Type</label
              >
              <select
                id="campaignType"
                class="w-full mt-1 p-3 border rounded-lg bg-gray-50"
              >
                <option value="broad">Video Ads Broad</option>
                <option value="phrase">Video Ads Phrase</option>
                <option value="exact">Video Ads Exact</option>
              </select>
            </div>
            <div>
              <label
                for="portfolioId"
                class="block text-sm font-medium text-gray-700"
                >Portfolio ID
                <span class="text-gray-400">(optional)</span></label
              >
              <div class="flex gap-2 mt-1">
                <input
                  type="text"
                  id="portfolioId"
                  class="flex-1 p-3 border rounded-lg bg-gray-50"
                />
                <button
                  type="button"
                  onclick="window.open('https://docs.google.com/spreadsheets/d/e/2PACX-1vSGHt7CfqrunDBeX-eOXTCsNlk-QnsttLhF3YtS10s11IUWXm_CJtbhFlVEG-6_J2MaAwSH85rGwL-u/pubhtml?gid=1772766919&single=true')"
                  class="text-sm text-blue-600 hover:underline"
                >
                  Check
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Product Details -->
        <div class="space-y-6">
          <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">
            Product Details
          </h2>
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label
                for="productNumber"
                class="block text-sm font-medium text-gray-700"
                >Product Number <span class="text-red-500">*</span></label
              >
              <input
                type="text"
                id="productNumber"
                class="w-full mt-1 p-3 border rounded-lg bg-gray-50"
              />
            </div>
            <div>
              <label for="sku" class="block text-sm font-medium text-gray-700"
                >SKU <span class="text-red-500">*</span></label
              >
              <input
                type="text"
                id="sku"
                class="w-full mt-1 p-3 border rounded-lg bg-gray-50"
              />
            </div>
            <div>
              <label for="asin" class="block text-sm font-medium text-gray-700"
                >ASIN <span class="text-red-500">*</span></label
              >
              <input
                type="text"
                id="asin"
                class="w-full mt-1 p-3 border rounded-lg bg-gray-50"
              />
            </div>
            <div>
              <label
                for="videoId"
                class="block text-sm font-medium text-gray-700"
                >Video Media ID <span class="text-red-500">*</span></label
              >
              <div class="flex gap-2 mt-1">
                <input
                  type="text"
                  id="videoId"
                  class="flex-1 p-3 border rounded-lg bg-gray-50"
                />
                <button
                  type="button"
                  onclick="document.getElementById('videoModal').classList.remove('hidden')"
                  class="text-sm text-blue-600 hover:underline"
                >
                  How to get
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Keywords Section -->
        <div class="space-y-6">
          <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">
            Keywords
          </h2>
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label
                for="keywords"
                class="block text-sm font-medium text-gray-700"
                >Targeting Keywords <span class="text-red-500">*</span
                ><br /><span class="text-xs text-gray-400"
                  >(one per line)</span
                ></label
              >
              <textarea
                id="keywords"
                class="w-full mt-1 p-3 border rounded-lg resize-none bg-gray-50 h-32"
              ></textarea>
            </div>
            <div>
              <label
                for="negativeKeywords"
                class="block text-sm font-medium text-gray-700"
                >Negative Keywords<br /><span class="text-xs text-gray-400"
                  >(one per line)</span
                ></label
              >
              <textarea
                id="negativeKeywords"
                class="w-full mt-1 p-3 border rounded-lg resize-none bg-gray-50 h-32"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="space-y-4 text-center">
          <div class="flex flex-wrap justify-center gap-4">
            <button
              id="clearFields"
              type="button"
              class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-6 rounded-lg transition"
            >
              Clear Fields
            </button>
            <button
              id="clearTemplate"
              type="button"
              class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition"
            >
              Clear Template
            </button>
            <button
              id="addTemplate"
              type="button"
              class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition"
            >
              Add to Template
            </button>
            <button
              id="downloadExcel"
              type="button"
              class="bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition"
            >
              Download Excel
            </button>
          </div>
          <div
            id="formError"
            class="text-red-600 font-semibold hidden mt-2"
          ></div>
        </div>
      </form>

      <!-- Campaign List -->
      <div
        class="mt-6 bg-gray-100 p-4 rounded-lg max-h-56 overflow-y-auto text-sm text-gray-800 border border-dashed"
      >
        <div id="campaignList" class="space-y-2"></div>
      </div>
    </div>

    <!-- Video Modal -->
    <div
      id="videoModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50"
    >
      <div class="bg-white rounded-lg shadow-lg max-w-md w-full p-6">
        <h3 class="text-lg font-semibold mb-4">How to get Video Media ID</h3>
        <p class="text-gray-700 mb-6">
          Go to your ad console, navigate to <strong>Assets > Video</strong> and
          upload your video first. You’ll find the Video Media ID associated
          with each uploaded video.
        </p>
        <div class="text-right">
          <button
            onclick="document.getElementById('videoModal').classList.add('hidden')"
            class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <script>
      let campaignData = [];
      const campaignList = document.getElementById("campaignList");

      const defaultColumns = [
        "Product",
        "Entity",
        "Operation",
        "Campaign Id",
        "Draft Campaign Id",
        "Portfolio Id",
        "Campaign Name",
        "Start Date",
        "End Date",
        "State",
        "Budget Type",
        "Budget",
        "Bid Optimization",
        "Bid Multiplier",
        "Bid",
        "Keyword Text",
        "Match Type",
        "Product Targeting Expression",
        "Ad Format",
        "Landing Page URL",
        "Landing Page asins",
        "Brand Entity Id",
        "Brand Name",
        "Brand Logo Asset Id",
        "Brand Logo URL",
        "Creative Headline",
        "Creative asins",
        "Video Media Ids",
        "Creative Type",
      ];

      const ensureDefaultColumns = (obj) => {
        return Object.fromEntries(
          defaultColumns.map((key) => [key, obj[key] ?? ""])
        );
      };

      document
        .getElementById("addTemplate")
        .addEventListener("click", async () => {
          const errorBox = document.getElementById("formError");
          errorBox.classList.add("hidden");
          errorBox.textContent = "";

          const country = document.getElementById("country").value;
          const productNumber = document
            .getElementById("productNumber")
            .value.trim();
          const sku = document.getElementById("sku").value.trim();
          const asin = document.getElementById("asin").value.trim();
          const portfolioId = document
            .getElementById("portfolioId")
            .value.trim();
          const videoId = document.getElementById("videoId").value.trim();
          const campaignType = document.getElementById("campaignType").value;
          const keywords = document
            .getElementById("keywords")
            .value.trim()
            .split("\n")
            .filter(Boolean);
          const negativeKeywords = document
            .getElementById("negativeKeywords")
            .value.trim()
            .split("\n")
            .filter(Boolean);

          if (
            !productNumber ||
            !sku ||
            !asin ||
            !videoId ||
            keywords.length === 0
          ) {
            errorBox.textContent =
              "❌ Please fill in all required fields marked with *";
            errorBox.classList.remove("hidden");
            return;
          }

          const today = new Date().toISOString().slice(0, 10).replace(/-/g, "");
          const campaignId = `${productNumber} ${sku} Video Ads ${
            campaignType.charAt(0).toUpperCase() + campaignType.slice(1)
          }`;
          const brandEntityId =
            country === "US" ? "ENTITYCQP7AL92VN6L" : "ENTITY2DMN2Z7IO7RFX";

          campaignData.push(
            ensureDefaultColumns({
              Product: "Sponsored Brands",
              Entity: "Campaign",
              Operation: "Create",
              "Campaign Id": campaignId,
              "Portfolio Id": portfolioId,
              "Campaign Name": campaignId,
              "Start Date": today,
              State: "Enabled",
              "Budget Type": "Daily",
              Budget: 10,
              "Bid Optimization": "Auto",
              "Ad Format": "video",
              "Brand Entity Id": brandEntityId,
              "Brand Name": "BlueStars",
              "Creative asins": asin,
              "Video Media Ids": videoId,
              "Creative Type": "video",
            })
          );

          keywords.forEach((kw) => {
            campaignData.push(
              ensureDefaultColumns({
                Product: "Sponsored Brands",
                Entity: "Keyword",
                Operation: "Create",
                "Campaign Id": campaignId,
                State: "Enabled",
                Bid: 0.25,
                "Keyword Text": kw,
                "Match Type": campaignType,
              })
            );
          });

          negativeKeywords.forEach((kw) => {
            campaignData.push(
              ensureDefaultColumns({
                Product: "Sponsored Brands",
                Entity: "Negative Keyword",
                Operation: "Create",
                "Campaign Id": campaignId,
                State: "Enabled",
                "Keyword Text": kw,
                "Match Type": "negativePhrase",
              })
            );
          });

          const line = document.createElement("div");
          line.className =
            "flex justify-between items-center bg-white p-2 rounded shadow mb-2";
          line.dataset.campaignId = campaignId;
          line.innerHTML = `
          <span>✔ Added: ${campaignId}</span>
          <button type="button" class="text-red-500 hover:text-red-700 font-bold text-lg ml-4" onclick="removeCampaign(this, '${campaignId}')">×</button>
        `;
          campaignList.appendChild(line);
        });

      function removeCampaign(button, campaignId) {
        const line = button.closest("div");
        if (line) line.remove();
        campaignData = campaignData.filter(
          (entry) => entry["Campaign Id"] !== campaignId
        );
      }

      document
        .getElementById("downloadExcel")
        .addEventListener("click", async () => {
          const XLSX = await import(
            "https://cdn.sheetjs.com/xlsx-0.20.2/package/xlsx.mjs"
          );
          const output =
            campaignData.length > 0
              ? campaignData
              : [Object.fromEntries(defaultColumns.map((key) => [key, ""]))];
          const worksheet = XLSX.utils.json_to_sheet(output, {
            header: defaultColumns,
          });
          const workbook = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(workbook, worksheet, "Campaign");
          XLSX.writeFile(workbook, "Video_Campaign_Upload_Template.xlsx");
        });

      document.getElementById("clearFields").addEventListener("click", () => {
        document.getElementById("campaignForm").reset();
      });

      document.getElementById("clearTemplate").addEventListener("click", () => {
        campaignData = [];
        campaignList.innerHTML = "";
        document.getElementById("formError").classList.add("hidden");
      });
    </script>
  </body>
</html>
